sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
  - recipient: age1wpk6a50fj9hepmve43dtx36fr6rfat6nsms6fx6rf4x2udmmtutsmtzctr
    enc: |
      -----BEGIN AGE ENCRYPTED FILE-----
      YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAyTkZrcWZSbjcvSEJabFVq
      SHJJVTIyMHBmbm1WWUViY2R0WnFkcEs1OFZ3CnBGN0dPMUJNUVp0SWRlU2pkd1d1
      bUdYc1Nuc0F3L0RLczRrSDlNekRnVmMKLS0tIHlnaDFBRHEwVXc3NURlRzFSbmNK
      NGhpSENuZlNHTnhUdzEyczBFbDVTTU0KriMPI7JD0obTrgG0ES1eGGOk+ZFxw71Z
      7hoG3gR4AroVsyzfT591ZrtIE/eCI1bJeGU/KeN3aeVfURLykINVCw==
      -----END AGE ENCRYPTED FILE-----
  lastmodified: "2023-12-25T22:14:52Z"
  mac: ENC[AES256_GCM,data:xuiVYlXi4TkUnS1pM/vgwnBmyu2vhPoDaifwbFe9b43i8De6d7433bsyI7sFBujso5bzKLPMbeo9t/XP8BReJ/QEWEcg671YxJq6ZKOBU/xgAqiljk7Yf+8cqEbrBU/Zc9XXK5MBz2Ttxq2SLpZSFGtU/9HJx10Dkwn+T2wdXX0=,iv:di9a4vRxnRcrKozaXxL+oK8YkOqFcsqraBNDCJtqSjM=,tag:94M6WAcORf7OcFefGvcL1g==,type:str]
  pgp: []
  encrypted_regex: ^(data|stringData)$
  version: 3.8.1
apiVersion: v1
kind: Namespace
metadata:
  name: pihole
---
apiVersion: v1
kind: Secret
metadata:
  name: pihole-secret
  namespace: pihole
data:
  password: ENC[AES256_GCM,data:oSQK9nsLVwNFcDxD4Y9swEQ=,iv:9DKhIQqmIWMQS6XXuRGOnFjVxQkuEVGB44PUgqnpUWA=,tag:XgyZaVYJbnonFbL+kP9aGA==,type:str]
type: Opaque
---
apiVersion: source.toolkit.fluxcd.io/v1beta2
kind: HelmRepository
metadata:
  name: pihole
  namespace: pihole
spec:
  interval: 5m
  url: https://mojo2600.github.io/pihole-kubernetes/
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: pihole
  namespace: pihole
spec:
  chart:
    spec:
      chart: pihole
      sourceRef:
        kind: HelmRepository
        name: pihole
  interval: 50m
  install:
    remediation:
      retries: 3
  values:
    serviceDns:
      mixedService: true
      type: LoadBalancer
      loadBalancerIP: 192.168.10.70
      annotations:
        metallb.universe.tf/allow-shared-ip: "10.70"
      externalTrafficPolicy: Cluster

    serviceDhcp:
      enabled: false

    virtualHost: pi.boo.eth0.work

    ingress:
      enabled: true
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt
      hosts:
      - pi.boo.eth0.work
      tls:
      - secretName: pi-le-cert
        hosts:
        - pi.boo.eth0.work

    persistentVolumeClaim:
      enabled: true
      storageClass: nfs-storage

    admin:
      existingSecret: pihole-secret

    extraEnvVars:
      TZ: America/Sao_Paulo

    DNS1: "1.1.1.1"
    DNS2: "1.0.0.1"

    podDnsConfig:
      enabled: false

    dnsmasq:
      customSettings:
        minTTL: # nome dessa chave é livre
          min-cache-ttl=3600 # 1h é o valor máximo permitido pelo dnsmasq
